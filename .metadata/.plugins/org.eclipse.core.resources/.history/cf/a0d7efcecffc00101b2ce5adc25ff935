package com.wipro.bank.dao;
import java.sql.Connection;
import java.sql.Date;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;

import com.wipro.bank.bean.TransferBean;
import com.wipro.bank.util.DButil;

public class BankDAO {
    public int generateSequenceNumber() {
    	return 0;
    }
    public boolean validateAccount(String AccountNumber) {
    	Connection connection=DButil.getDBConnection();
    	String query = "select * from Account_tbl where Account_Number=?" ;
    	
    	try {
    	PreparedStatement ps= connection.prepareStatement(query);
    	ps.setString(1,AccountNumber);
    	ResultSet rs= ps.executeQuery();
    	
    	if(rs.next()) {
        	return true;
    		}
    	    return false;
        }  catch (SQLException e) {
    	  e.printStackTrace();
    	  return false;
       }
    }
    public float findBalance( String AccountNumber) {
    	if(validateAccount( AccountNumber)) {
    		Connection connection = DButil.getDBConnection();
    		String query = " select balance from Account_tbl where Account_Number=? ";
    		
    		try {
    			PreparedStatement ps =connection.prepareStatement(query);
    			ps.setString(1, AccountNumber);
    			ResultSet rs = ps.executeQuery();
    			rs.next ();
       		    float balance = rs.getFloat(1);
                return balance;
                
    		}catch (SQLException e) {
    			e.printStackTrace();
    		}
    		
            }
             return -1;

    }
    public boolean updateBalance(String AccountNumber, float newBalance) throws SQLException{
    	Connection connection = DButil.getDBConnection();
    	String query="update Account_tbl set balance= ? where Account_Number=?";
    	
    	try {
    		PreparedStatement ps =connection.prepareStatement(query);
			ps.setString(1, AccountNumber);
			ps.setFloat(1, newBalance);
			ResultSet rs = ps.executeQuery();
			if(rs.next()) {
	        	return true;
	    		}
	    	    return false;

    	}catch (SQLException e) {
    		e.printStackTrace();
    	}
    	return false;
     }
     public int generateSequenceNumber1(){
     Connection connection =DButil.getDBConnection();
     String query="select transactionID_seq.NEXTVAL from dual";
     try {
    	    PreparedStatement ps =connection.prepareStatement(query);
			ResultSet rs = ps.executeQuery();
			rs.next ();
			int seqNumber=rs.getInt(1);
			return seqNumber;
     }catch (SQLException e) {
    	    e.printStackTrace();
    		return 0;
        }
     }
     public boolean transferMoney(TransferBean transferBean) {
    	 transferBean.setTransactionID(generateSequenceNumber());
    	 Connection connection =DButil.getDBConnection();
         String query="INSERT INTO TRANSFER_TBL VALUES (?, ?, ?, ?, ?) ";
         
         try {
            PreparedStatement PreparedStatement =connection.prepareStatement(query);
            PreparedStatement.setInt(1,transferBean.getTransactionID());
            PreparedStatement.setString(2,transferBean.getFromAccountNumber());
            PreparedStatement.setString(3,transferBean.getToAccountNumber());
            Date d=new Date(transferBean.getDateOfTransactionID().getTime());
            PreparedStatement.setDate(4, d );
            PreparedStatement.setFloat(5, transferBean.getAmount());
            int rows=PreparedStatement.executeUpdate();
 if (rows>0) {
	 return true;
 }else return false;
         }catch(SQLException e) {
        	e.printStackTrace();
     }
         return false;
    }
 }